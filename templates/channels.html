<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}}</title>
    <link rel="stylesheet" href="/static/css/fuzzy.css">
    <style>
        /* Channel management specific styles */
        .channel-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-lg);
        }
        
        .channel-card {
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            background-color: var(--bg-primary);
            transition: var(--transition-fast);
        }
        
        .channel-card:hover {
            box-shadow: var(--shadow-md);
        }
        
        .channel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }
        
        .channel-name {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }
        
        .channel-status {
            padding: 4px 12px;
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            font-weight: 600;
        }
        
        .status-running {
            background-color: var(--success-light);
            color: var(--success-color);
        }
        
        .status-stopped {
            background-color: var(--danger-light);
            color: var(--danger-color);
        }
        
        .channel-info {
            margin-bottom: var(--spacing-md);
        }
        
        .channel-info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-xs);
            font-size: var(--font-size-sm);
        }
        
        .channel-info-label {
            color: var(--text-muted);
            font-weight: 500;
        }
        
        .channel-info-value {
            color: var(--text-secondary);
        }
        
        .channel-actions {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }
        
        .encoding-section {
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            background-color: var(--gray-50);
        }
        
        .encoding-section h3 {
            margin: 0 0 var(--spacing-md) 0;
            color: var(--text-primary);
            font-size: var(--font-size-lg);
        }
        
        .edit-form {
            display: none;
            background-color: var(--warning-light);
            border: 1px solid var(--warning-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin: var(--spacing-md) 0;
        }
        
        @media (max-width: 768px) {
            .channel-grid {
                grid-template-columns: 1fr;
            }
            
            .channel-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .channel-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <div class="content-wrapper">
            <div class="container">
                <div class="text-center mb-5">
                    <div class="icon icon-xl">◈</div>
                    <h1>Channel Management</h1>
                </div>
                
                <div class="navigation">
                    <a href="/" class="nav-link">⌂ Dashboard</a>
                    <a href="/providers" class="nav-link">⚡ Providers</a>
                    <a href="/users" class="nav-link">⚪ Users</a>
                </div>

                {{if .Message}}
                <div class="message message-success">{{.Message}}</div>
                {{end}}

                {{if .Error}}
                <div class="message message-error">{{.Error}}</div>
                {{end}}

                <!-- Add Channel Form -->
                <div class="form-card">
                    <h2>➕ Add New Channel</h2>
                    <form method="post" action="/channels">
                        <input type="hidden" name="action" value="add_channel">
                        
                        <!-- Basic Information -->
                        <div class="encoding-section">
                            <h3>📺 Basic Information</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="name">Channel Name:</label>
                                    <input type="text" id="name" name="name" required placeholder="BBC One HD">
                                </div>
                                
                                <div class="form-group">
                                    <label for="manifest">Manifest URL:</label>
                                    <input type="url" id="manifest" name="manifest" required placeholder="https://example.com/playlist.m3u8">
                                </div>
                                
                                <div class="form-group">
                                    <label for="key_kid">Key:Kid:</label>
                                    <input type="text" id="key_kid" name="key_kid" required placeholder="bbc1-key-001">
                                </div>
                            </div>
                        </div>

                        <!-- Video Encoding Settings -->
                        <div class="encoding-section">
                            <h3>🎬 Video Encoding</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="video_codec">Video Codec:</label>
                                    <select id="video_codec" name="video_codec">
                                        <option value="x264">H.264 (x264) - Compatible</option>
                                        <option value="x265" selected>H.265 (x265) - Efficient</option>
                                        <option value="av1">AV1 - Future</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="video_bitrate">Video Bitrate:</label>
                                    <select id="video_bitrate" name="video_bitrate">
                                        <option value="1000k">1 Mbps - Low</option>
                                        <option value="2500k" selected>2.5 Mbps - Medium</option>
                                        <option value="5000k">5 Mbps - High</option>
                                        <option value="8000k">8 Mbps - Ultra</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="resolution">Resolution:</label>
                                    <select id="resolution" name="resolution">
                                        <option value="720p">720p HD</option>
                                        <option value="1080p" selected>1080p Full HD</option>
                                        <option value="1440p">1440p QHD</option>
                                        <option value="2160p">2160p 4K UHD</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Audio Encoding Settings -->
                        <div class="encoding-section">
                            <h3>🔊 Audio Encoding</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="audio_codec">Audio Codec:</label>
                                    <select id="audio_codec" name="audio_codec">
                                        <option value="AAC" selected>AAC - Standard</option>
                                        <option value="MP3">MP3 - Compatible</option>
                                        <option value="AC3">AC3 - Dolby Digital</option>
                                        <option value="DTS">DTS - Cinema</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="audio_bitrate">Audio Bitrate:</label>
                                    <select id="audio_bitrate" name="audio_bitrate">
                                        <option value="96k">96 kbps</option>
                                        <option value="128k" selected>128 kbps</option>
                                        <option value="192k">192 kbps</option>
                                        <option value="256k">256 kbps</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="audio_channels">Audio Channels:</label>
                                    <select id="audio_channels" name="audio_channels">
                                        <option value="mono">Mono</option>
                                        <option value="stereo" selected>Stereo</option>
                                        <option value="5.1">5.1 Surround</option>
                                        <option value="7.1">7.1 Surround</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Add Channel</button>
                    </form>
                </div>

                <!-- Channels List -->
                <div class="form-card">
                    <h2>📋 Existing Channels</h2>
                    
                    {{if .Channels}}
                    <div class="channel-grid">
                        {{range .Channels}}
                        <div class="channel-card">
                            <div class="channel-header">
                                <h3 class="channel-name">{{.Name}}</h3>
                                <span class="channel-status {{if .IsRunning}}status-running{{else}}status-stopped{{end}}">
                                    {{if .IsRunning}}● Running{{else}}○ Stopped{{end}}
                                </span>
                            </div>
                            
                            <div class="channel-info">
                                <div class="channel-info-item">
                                    <span class="channel-info-label">Manifest:</span>
                                    <span class="channel-info-value">{{.Manifest}}</span>
                                </div>
                                <div class="channel-info-item">
                                    <span class="channel-info-label">Key:Kid:</span>
                                    <span class="channel-info-value">{{.KeyKid}}</span>
                                </div>
                                <div class="channel-info-item">
                                    <span class="channel-info-label">Video:</span>
                                    <span class="channel-info-value">{{.VideoCodec}} @ {{.VideoBitrate}}</span>
                                </div>
                                <div class="channel-info-item">
                                    <span class="channel-info-label">Audio:</span>
                                    <span class="channel-info-value">{{.AudioCodec}} @ {{.AudioBitrate}}</span>
                                </div>
                                <div class="channel-info-item">
                                    <span class="channel-info-label">Resolution:</span>
                                    <span class="channel-info-value">{{.Resolution}}</span>
                                </div>
                            </div>
                            
                            <div class="channel-actions">
                                {{if .IsRunning}}
                                <a href="/channel/stop?id={{.ID}}" class="btn btn-warning btn-sm">Stop</a>
                                {{else}}
                                <a href="/channel/start?id={{.ID}}" class="btn btn-success btn-sm">Start</a>
                                {{end}}
                                <button onclick="showEditForm({{.ID}})" class="btn btn-secondary btn-sm">Edit</button>
                                <form method="post" action="/channels" style="display: inline;">
                                    <input type="hidden" name="action" value="delete_channel">
                                    <input type="hidden" name="id" value="{{.ID}}">
                                    <button type="submit" class="btn btn-danger btn-sm" 
                                            onclick="return confirmDelete({{.ID}}, '{{.Name}}')">Delete</button>
                                </form>
                            </div>

                            <!-- Edit Form -->
                            <div id="edit-form-{{.ID}}" class="edit-form">
                                <h4>Edit Channel: {{.Name}}</h4>
                                <form method="post" action="/channels">
                                    <input type="hidden" name="action" value="edit_channel">
                                    <input type="hidden" name="id" value="{{.ID}}">
                                    
                                    <!-- Basic Information -->
                                    <div style="margin-bottom: var(--spacing-md);">
                                        <h5>📺 Basic Information</h5>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="edit-name-{{.ID}}">Channel Name:</label>
                                                <input type="text" id="edit-name-{{.ID}}" name="name" value="{{.Name}}" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="edit-manifest-{{.ID}}">Manifest URL:</label>
                                                <input type="url" id="edit-manifest-{{.ID}}" name="manifest" value="{{.Manifest}}" required>
                                            </div>
                                            <div class="form-group">
                                                <label for="edit-key-kid-{{.ID}}">Key:Kid:</label>
                                                <input type="text" id="edit-key-kid-{{.ID}}" name="key_kid" value="{{.KeyKid}}" required>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Video Encoding -->
                                    <div style="margin-bottom: var(--spacing-md);">
                                        <h5>🎬 Video Encoding</h5>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="edit-video-codec-{{.ID}}">Video Codec:</label>
                                                <select id="edit-video-codec-{{.ID}}" name="video_codec">
                                                    <option value="x264" {{if eq .VideoCodec "x264"}}selected{{end}}>H.264 (x264)</option>
                                                    <option value="x265" {{if eq .VideoCodec "x265"}}selected{{end}}>H.265 (x265)</option>
                                                    <option value="av1" {{if eq .VideoCodec "av1"}}selected{{end}}>AV1</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="edit-video-bitrate-{{.ID}}">Video Bitrate:</label>
                                                <select id="edit-video-bitrate-{{.ID}}" name="video_bitrate">
                                                    <option value="1000k" {{if eq .VideoBitrate "1000k"}}selected{{end}}>1 Mbps</option>
                                                    <option value="2500k" {{if eq .VideoBitrate "2500k"}}selected{{end}}>2.5 Mbps</option>
                                                    <option value="5000k" {{if eq .VideoBitrate "5000k"}}selected{{end}}>5 Mbps</option>
                                                    <option value="8000k" {{if eq .VideoBitrate "8000k"}}selected{{end}}>8 Mbps</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="edit-resolution-{{.ID}}">Resolution:</label>
                                                <select id="edit-resolution-{{.ID}}" name="resolution">
                                                    <option value="720p" {{if eq .Resolution "720p"}}selected{{end}}>720p HD</option>
                                                    <option value="1080p" {{if eq .Resolution "1080p"}}selected{{end}}>1080p Full HD</option>
                                                    <option value="1440p" {{if eq .Resolution "1440p"}}selected{{end}}>1440p QHD</option>
                                                    <option value="2160p" {{if eq .Resolution "2160p"}}selected{{end}}>2160p 4K UHD</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Audio Encoding -->
                                    <div style="margin-bottom: var(--spacing-md);">
                                        <h5>🔊 Audio Encoding</h5>
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="edit-audio-codec-{{.ID}}">Audio Codec:</label>
                                                <select id="edit-audio-codec-{{.ID}}" name="audio_codec">
                                                    <option value="AAC" {{if eq .AudioCodec "AAC"}}selected{{end}}>AAC</option>
                                                    <option value="MP3" {{if eq .AudioCodec "MP3"}}selected{{end}}>MP3</option>
                                                    <option value="AC3" {{if eq .AudioCodec "AC3"}}selected{{end}}>AC3</option>
                                                    <option value="DTS" {{if eq .AudioCodec "DTS"}}selected{{end}}>DTS</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="edit-audio-bitrate-{{.ID}}">Audio Bitrate:</label>
                                                <select id="edit-audio-bitrate-{{.ID}}" name="audio_bitrate">
                                                    <option value="96k" {{if eq .AudioBitrate "96k"}}selected{{end}}>96 kbps</option>
                                                    <option value="128k" {{if eq .AudioBitrate "128k"}}selected{{end}}>128 kbps</option>
                                                    <option value="192k" {{if eq .AudioBitrate "192k"}}selected{{end}}>192 kbps</option>
                                                    <option value="256k" {{if eq .AudioBitrate "256k"}}selected{{end}}>256 kbps</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="edit-audio-channels-{{.ID}}">Audio Channels:</label>
                                                <select id="edit-audio-channels-{{.ID}}" name="audio_channels">
                                                    <option value="mono" {{if eq .AudioChannels "mono"}}selected{{end}}>Mono</option>
                                                    <option value="stereo" {{if eq .AudioChannels "stereo"}}selected{{end}}>Stereo</option>
                                                    <option value="5.1" {{if eq .AudioChannels "5.1"}}selected{{end}}>5.1 Surround</option>
                                                    <option value="7.1" {{if eq .AudioChannels "7.1"}}selected{{end}}>7.1 Surround</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div style="display: flex; gap: var(--spacing-sm);">
                                        <button type="submit" class="btn btn-primary btn-sm">Update Channel</button>
                                        <button type="button" onclick="hideEditForm({{.ID}})" class="btn btn-secondary btn-sm">Cancel</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        {{end}}
                    </div>
                    {{else}}
                    <p class="text-muted text-center">No channels configured yet. Add one above to get started.</p>
                    {{end}}
                </div>
            </div>
        </div>
    </div>

    <script>
        function showEditForm(id) {
            // Hide all edit forms
            const editForms = document.querySelectorAll('.edit-form');
            editForms.forEach(form => form.style.display = 'none');
            
            // Show the specific edit form
            const form = document.getElementById('edit-form-' + id);
            if (form) {
                form.style.display = 'block';
            }
        }
        
        function hideEditForm(id) {
            const form = document.getElementById('edit-form-' + id);
            if (form) {
                form.style.display = 'none';
            }
        }
        
        function confirmDelete(id, name) {
            return confirm('Are you sure you want to delete the channel "' + name + '"?');
        }
    </script>
</body>
</html>