<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}}</title>
    <link rel="stylesheet" href="/static/css/fuzzy.css">
    <style>
        /* User management specific styles */
        .user-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--spacing-lg);
            background-color: var(--bg-primary);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }
        
        .user-table th {
            background-color: var(--gray-100);
            color: var(--text-primary);
            font-weight: 600;
            padding: var(--spacing-md);
            text-align: left;
            border-bottom: 2px solid var(--gray-200);
        }
        
        .user-table td {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--gray-200);
            vertical-align: middle;
        }
        
        .user-table tr:hover {
            background-color: var(--gray-50);
        }
        
        .user-actions {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }
        
        .edit-form {
            display: none;
            background-color: var(--warning-light);
            border: 1px solid var(--warning-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin: var(--spacing-sm) 0;
        }
        
        .status-active {
            color: var(--success-color);
            font-weight: 600;
        }
        
        .status-inactive {
            color: var(--danger-color);
            font-weight: 600;
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }
        
        .user-email {
            font-size: var(--font-size-sm);
            color: var(--text-muted);
        }
        
        .user-role {
            display: inline-block;
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            font-weight: 600;
            background-color: var(--info-light);
            color: var(--info-color);
        }
        
        .admin-role {
            background-color: var(--primary-light);
            color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .user-table {
                font-size: var(--font-size-sm);
            }
            
            .user-table th,
            .user-table td {
                padding: var(--spacing-sm);
            }
            
            .user-actions {
                flex-direction: column;
            }
            
            .user-actions .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <div class="content-wrapper">
            <div class="container">
                <div class="text-center mb-5">
                    <div class="icon icon-xl">âšª</div>
                    <h1>User Management</h1>
                </div>
                
                <div class="navigation">
                    <a href="/" class="nav-link">âŒ‚ Dashboard</a>
                    <a href="/providers" class="nav-link">âš¡ Providers</a>
                    <a href="/channels" class="nav-link">â—ˆ Channels</a>
                </div>

                {{if .Message}}
                <div class="message message-success">{{.Message}}</div>
                {{end}}

                {{if .Error}}
                <div class="message message-error">{{.Error}}</div>
                {{end}}

                <!-- Add User Form -->
                <div class="form-card">
                    <h2>âž• Add New User</h2>
                    <form method="post" action="/users">
                        <input type="hidden" name="action" value="add">
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="username">Username:</label>
                                <input type="text" id="username" name="username" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="email">Email:</label>
                                <input type="email" id="email" name="email">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="password">Password:</label>
                                <input type="password" id="password" name="password" required>
                                <small class="text-muted">Minimum 8 characters with uppercase, lowercase, number and special character</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="role">Role:</label>
                                <select id="role" name="role" required>
                                    <option value="user">User</option>
                                    <option value="admin">Administrator</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="active" name="active" checked>
                                <label for="active">Active User</label>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Add User</button>
                    </form>
                </div>

                <!-- Users List -->
                <div class="form-card">
                    <h2>ðŸ‘¥ Existing Users</h2>
                    
                    {{if .Users}}
                    <div class="table-container">
                        <table class="user-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{range .Users}}
                                <tr>
                                    <td>
                                        <div class="user-info">
                                            <span class="user-name">{{.Username}}</span>
                                            {{if .Email}}<span class="user-email">{{.Email}}</span>{{end}}
                                        </div>
                                    </td>
                                    <td>
                                        <span class="user-role {{if eq .Role "admin"}}admin-role{{end}}">
                                            {{if eq .Role "admin"}}Administrator{{else}}User{{end}}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="{{if .Active}}status-active{{else}}status-inactive{{end}}">
                                            {{if .Active}}Active{{else}}Inactive{{end}}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="text-muted">{{.CreatedAt.Format "2006-01-02"}}</span>
                                    </td>
                                    <td>
                                        <div class="user-actions">
                                            <button onclick="showEditForm({{.ID}})" class="btn btn-secondary btn-sm">Edit</button>
                                            {{if ne .Role "admin"}}
                                            <form method="post" action="/users" style="display: inline;">
                                                <input type="hidden" name="action" value="delete">
                                                <input type="hidden" name="id" value="{{.ID}}">
                                                <button type="submit" class="btn btn-danger btn-sm" 
                                                        onclick="return confirmDelete({{.ID}}, '{{.Username}}')">Delete</button>
                                            </form>
                                            {{end}}
                                        </div>
                                    </td>
                                </tr>
                                
                                <!-- Edit Form Row -->
                                <tr>
                                    <td colspan="5">
                                        <div id="edit-form-{{.ID}}" class="edit-form">
                                            <h4>Edit User: {{.Username}}</h4>
                                            <form method="post" action="/users">
                                                <input type="hidden" name="action" value="edit">
                                                <input type="hidden" name="id" value="{{.ID}}">
                                                
                                                <div class="form-row">
                                                    <div class="form-group">
                                                        <label for="edit-username-{{.ID}}">Username:</label>
                                                        <input type="text" id="edit-username-{{.ID}}" name="username" value="{{.Username}}" required>
                                                    </div>
                                                    
                                                    <div class="form-group">
                                                        <label for="edit-email-{{.ID}}">Email:</label>
                                                        <input type="email" id="edit-email-{{.ID}}" name="email" value="{{.Email}}">
                                                    </div>
                                                </div>
                                                
                                                <div class="form-row">
                                                    <div class="form-group">
                                                        <label for="edit-password-{{.ID}}">New Password (leave blank to keep current):</label>
                                                        <input type="password" id="edit-password-{{.ID}}" name="password">
                                                    </div>
                                                    
                                                    <div class="form-group">
                                                        <label for="edit-role-{{.ID}}">Role:</label>
                                                        <select id="edit-role-{{.ID}}" name="role" required>
                                                            <option value="user" {{if eq .Role "user"}}selected{{end}}>User</option>
                                                            <option value="admin" {{if eq .Role "admin"}}selected{{end}}>Administrator</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                
                                                <div class="form-group">
                                                    <div class="checkbox-group">
                                                        <input type="checkbox" id="edit-active-{{.ID}}" name="active" {{if .Active}}checked{{end}}>
                                                        <label for="edit-active-{{.ID}}">Active User</label>
                                                    </div>
                                                </div>
                                                
                                                <div style="display: flex; gap: var(--spacing-sm);">
                                                    <button type="submit" class="btn btn-primary btn-sm">Update User</button>
                                                    <button type="button" onclick="hideEditForm({{.ID}})" class="btn btn-secondary btn-sm">Cancel</button>
                                                </div>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                {{end}}
                            </tbody>
                        </table>
                    </div>
                    {{else}}
                    <p class="text-muted text-center">No users found. Add a user above to get started.</p>
                    {{end}}
                </div>
            </div>
        </div>
    </div>

    <script>
        function showEditForm(id) {
            // Hide all edit forms
            const editForms = document.querySelectorAll('.edit-form');
            editForms.forEach(form => form.style.display = 'none');
            
            // Show the specific edit form
            const form = document.getElementById('edit-form-' + id);
            if (form) {
                form.style.display = 'block';
            }
        }
        
        function hideEditForm(id) {
            const form = document.getElementById('edit-form-' + id);
            if (form) {
                form.style.display = 'none';
            }
        }
        
        function confirmDelete(id, username) {
            return confirm('Are you sure you want to delete the user "' + username + '"?');
        }
    </script>
</body>
</html>